[pnbone@retdrbastion ~]$ nmap --script ssl-enum-ciphers -p 443 pnbone-prod-retail.hcpdc.obc.co.in  -Pn
Starting Nmap 7.92 ( https://nmap.org ) at 2025-09-20 12:37 IST
Nmap scan report for pnbone-prod-retail.hcpdc.obc.co.in (10.209.19.87)
Host is up (0.0017s latency).
Other addresses for pnbone-prod-retail.hcpdc.obc.co.in (not scanned): 10.209.19.84 10.209.19.85 10.209.19.86
rDNS record for 10.209.19.87: dr-retail-prod.dr-pnbone-prod-retail.hcpdc.obc.co.in

PORT    STATE SERVICE
443/tcp open  https
| ssl-enum-ciphers:
|   TLSv1.2:
|     ciphers:
|       TLS_DHE_RSA_WITH_AES_256_CBC_SHA (dh 2048) - A
|       TLS_DHE_RSA_WITH_AES_128_CBC_SHA (dh 2048) - A
|       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A
|       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A
|     compressors:
|       NULL
|     cipher preference: server
|   TLSv1.3:
|     ciphers:
|       TLS_AKE_WITH_AES_128_GCM_SHA256 (secp256r1) - A
|     cipher preference: indeterminate
|     cipher preference error: Too few ciphers supported
|_  least strength: A

Nmap done: 1 IP address (1 host up) scanned in 0.30 seconds
[pnbone@retdrbastion ~]$

[pnbone@retdcbastion busy]$ nmap --script ssl-enum-ciphers -p 443 pnbone-01.hcpdr.obc.co.in -Pn
Starting Nmap 7.92 ( https://nmap.org ) at 2025-09-20 12:32 IST
Nmap scan report for pnbone-01.hcpdr.obc.co.in (10.192.30.191)
Host is up (0.0044s latency).
Other addresses for pnbone-01.hcpdr.obc.co.in (not scanned): 10.192.30.194 10.192.30.193 10.192.30.192
rDNS record for 10.192.30.191: *.hcpdr.obc.co.in

PORT    STATE SERVICE
443/tcp open  https
| ssl-enum-ciphers:
|   TLSv1.2:
|     ciphers:
|       TLS_DHE_RSA_WITH_AES_256_CBC_SHA (dh 2048) - A
|       TLS_DHE_RSA_WITH_AES_128_CBC_SHA (dh 2048) - A
|       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 2048) - A
|       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 2048) - A
|     compressors:
|       NULL
|     cipher preference: server
|_  least strength: A

Nmap done: 1 IP address (1 host up) scanned in 0.50 seconds
[pnbone@retdcbastion busy]$

=================================================================
https://access.redhat.com/articles/5348961
=================================================================


Port 10250 is used by the Kubelet in Kubernetes for internal API communication. It typically serves:

Health checks

Pod logs

Exec and attach commands

Metrics and status queries

This traffic is not browser-based, and HSTS (HTTP Strict Transport Security) is a browser security feature. HSTS only applies to HTTPS web traffic accessed via browsers — not to internal service-to-service communication over TCP or REST APIs used by Kubernetes components.
                    
=======================================================
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILOs19s+4Br+227jjA8oCjglCdCtbaQhWMYl+BzYcg7s pnb\v-01010033@HO39990FIN00023
====================================
S.No.

Date

Division

System / Process

QSA Comments

4

17-09-2025

DBTD

PNB ONE BIZ

 

OCP – Hardening evidence will be required as per https://community.ibm.com/community/user/blogs/paul-bastide/2023/11/21/configuring-a-pci-dss-compliant-openshift-containe

==============================================================================================
https://docs.redhat.com/en/documentation/openshift_container_platform/4.18/html/security_and_compliance/file-integrity-operator#troubleshooting-file-integrity-operator

[oneadmin@bastion ~]$ oc get fileintegritynodestatuses.fileintegrity.openshift.io -n openshift-file-integrity
[oneadmin@bastion ~]$ oc get fileintegrities.fileintegrity.openshift.io -n openshift-file-integrity
NAME                  AGE
fileintegrity         21h
infra-fileintegrity   19h
[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc get fileintegritynodestatuses.fileintegrity.openshift.io -n openshift-file-integrity
NAME                                        NODE                          STATUS
fileintegrity-worker1.nonprod.mypnbone.in   worker1.nonprod.mypnbone.in   Failed
fileintegrity-worker2.nonprod.mypnbone.in   worker2.nonprod.mypnbone.in   Succeeded
fileintegrity-worker3.nonprod.mypnbone.in   worker3.nonprod.mypnbone.in   Succeeded
fileintegrity-worker4.nonprod.mypnbone.in   worker4.nonprod.mypnbone.in   Succeeded
fileintegrity-worker5.nonprod.mypnbone.in   worker5.nonprod.mypnbone.in   Succeeded
[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc get fileintegritynodestatuses.fileintegrity.openshift.io/fileintegrity-worker1.nonprod.mypnbone.in -n openshift-file-integrity -ojsonpath='{.results}' | jq -r
[
  {
    "condition": "Succeeded",
    "lastProbeTime": "2025-09-26T07:22:48Z"
  },
  {
    "condition": "Failed",
    "filesChanged": 1,
    "lastProbeTime": "2025-09-26T07:28:15Z",
    "resultConfigMapName": "aide-fileintegrity-worker1.nonprod.mypnbone.in-failed",
    "resultConfigMapNamespace": "openshift-file-integrity"
  }
]
[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc describe cm aide-fileintegrity-worker1.nonprod.mypnbone.in-failed  -n openshift-file-integrity
Name:         aide-fileintegrity-worker1.nonprod.mypnbone.in-failed
Namespace:    openshift-file-integrity
Labels:       file-integrity.openshift.io/node=worker1.nonprod.mypnbone.in
              file-integrity.openshift.io/owner=fileintegrity
              file-integrity.openshift.io/result-log=
Annotations:  file-integrity.openshift.io/files-added: 0
              file-integrity.openshift.io/files-changed: 1
              file-integrity.openshift.io/files-removed: 0

Data
====
integritylog:
----
Start timestamp: 2025-09-26 07:28:35 +0000 (AIDE 0.16)
AIDE found differences between database and filesystem!!

Summary:
  Total number of entries:  36247
  Added entries:              0
  Removed entries:            0
  Changed entries:            1

---------------------------------------------------
Changed entries:
---------------------------------------------------

f   ...    .C... : /hostroot/etc/resolv.conf

---------------------------------------------------
Detailed information about changes:
---------------------------------------------------

File: /hostroot/etc/resolv.conf
  SHA512   : soG6u6KB+Jdb0jD8zj87m5RGrFRgRNV5 | PxPKqw9nsunZbaV3kzkcA9VBsZfZ5o/E
             aD5upRmki+weH03IwEUVPFEsq09oikD4 | 1IoayvwXBfiqnew30noSBlsBVdNOC7Dk
             4l4VFRZUq5EBrX+XT4ivBA==         | ZtQpTcR93nvSZcj7GurOYQ==


---------------------------------------------------
The attributes of the (uncompressed) database(s):
---------------------------------------------------

/hostroot/etc/kubernetes/aide.db.gz
  MD5      : jGJswDbetI4+5BXT5K3PCQ==
  SHA1     : otHStcS1C8gpLxboiXqjmNQgQK0=
  RMD160   : PrjQ5/pJQpnjIYuJk/zsjZEIuUY=
  TIGER    : yDt/6DiLtzDElcL59/T7vc29Mku1DPgR
  SHA256   : 3AToUHGIxH7TKJeH5lzCYVOOPS6UP+HI
             9JmakKI1KOo=
  SHA512   : 88elRmTHqHoIjJ1GWag34UBn401o33Kk
             q7CHcXfWW1KbMuIWeBqog7YOcZCa/X4D
             /UH+Nu8zDU7FjrV3DSElsw==


End timestamp: 2025-09-26 07:29:39 +0000 (run time: 1m 4s)


BinaryData
====

Events:  <none>
[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc get fileintegritynodestatuses.fileintegrity.openshift.io -n openshift-file-integrity -o json | jq '.items[] | {node: .nodeName, status: .status, results: .results}'
[oneadmin@bastion ~]$ oc get configmap -n openshift-file-integrity | grep failed
aide-fileintegrity-worker1.nonprod.mypnbone.in-failed   1      20h
[oneadmin@bastion ~]$ oc logs -n openshift-file-integrity -l app=aide-fileintegrity
Defaulted container "daemon" out of: daemon, check-folder (init)
Defaulted container "daemon" out of: daemon, check-folder (init)
Defaulted container "daemon" out of: daemon, check-folder (init)
Defaulted container "daemon" out of: daemon, check-folder (init)
Defaulted container "daemon" out of: daemon, check-folder (init)
2025-09-26T07:32:37Z: aide check returned status 0
2025-09-26T07:32:57Z: running aide check
2025-09-26T07:33:54Z: aide check returned status 0
2025-09-26T07:34:14Z: running aide check
2025-09-26T07:35:02Z: aide check returned status 0
2025-09-26T07:35:22Z: running aide check
2025-09-26T07:36:20Z: aide check returned status 0
2025-09-26T07:36:40Z: running aide check
2025-09-26T07:37:27Z: aide check returned status 0
2025-09-26T07:37:47Z: running aide check
2025-09-26T07:31:40Z: aide check returned status 0
2025-09-26T07:32:00Z: running aide check
2025-09-26T07:33:12Z: aide check returned status 0
2025-09-26T07:33:32Z: running aide check
2025-09-26T07:34:42Z: aide check returned status 0
2025-09-26T07:35:02Z: running aide check
2025-09-26T07:36:13Z: aide check returned status 0
2025-09-26T07:36:33Z: running aide check
2025-09-26T07:37:44Z: aide check returned status 0
2025-09-26T07:38:04Z: running aide check
2025-09-26T07:34:59Z: aide check returned status 0
2025-09-26T07:35:19Z: running aide check
2025-09-26T07:35:43Z: aide check returned status 0
2025-09-26T07:36:03Z: running aide check
2025-09-26T07:36:27Z: aide check returned status 0
2025-09-26T07:36:47Z: running aide check
2025-09-26T07:37:12Z: aide check returned status 0
2025-09-26T07:37:32Z: running aide check
2025-09-26T07:37:56Z: aide check returned status 0
2025-09-26T07:38:16Z: running aide check
2025-09-26T07:35:09Z: running aide check
2025-09-26T07:35:32Z: aide check returned status 0
2025-09-26T07:35:52Z: running aide check
2025-09-26T07:36:13Z: aide check returned status 0
2025-09-26T07:36:33Z: running aide check
2025-09-26T07:36:55Z: aide check returned status 0
2025-09-26T07:37:15Z: running aide check
2025-09-26T07:37:37Z: aide check returned status 0
2025-09-26T07:37:57Z: running aide check
2025-09-26T07:38:18Z: aide check returned status 0
2025-09-26T07:32:25Z: aide check returned status 4
2025-09-26T07:32:45Z: running aide check
2025-09-26T07:33:46Z: aide check returned status 4
2025-09-26T07:34:06Z: running aide check
2025-09-26T07:35:07Z: aide check returned status 4
2025-09-26T07:35:27Z: running aide check
2025-09-26T07:36:31Z: aide check returned status 4
2025-09-26T07:36:51Z: running aide check
2025-09-26T07:37:52Z: aide check returned status 4
2025-09-26T07:38:12Z: running aide check
[oneadmin@bastion ~]$ oc -n openshift-file-integrity get pods -owide
NAME                                      READY   STATUS    RESTARTS      AGE   IP             NODE                          NOMINATED NODE   READINESS GATES
aide-fileintegrity-4thdn                  1/1     Running   0             21h   10.129.5.43    worker5.nonprod.mypnbone.in   <none>           <none>
aide-fileintegrity-4wj57                  1/1     Running   0             21h   10.129.3.132   worker1.nonprod.mypnbone.in   <none>           <none>
aide-fileintegrity-fqhwk                  1/1     Running   0             21h   10.131.2.122   worker3.nonprod.mypnbone.in   <none>           <none>
aide-fileintegrity-pjpdj                  1/1     Running   0             21h   10.128.5.95    worker2.nonprod.mypnbone.in   <none>           <none>
aide-fileintegrity-vw2t8                  1/1     Running   0             21h   10.130.5.125   worker4.nonprod.mypnbone.in   <none>           <none>
aide-infra-fileintegrity-8flqh            0/1     Pending   0             20h   <none>         <none>                        <none>           <none>
aide-infra-fileintegrity-9wbsk            0/1     Pending   0             20h   <none>         <none>                        <none>           <none>
aide-infra-fileintegrity-khlhl            0/1     Pending   0             20h   <none>         <none>                        <none>           <none>
file-integrity-operator-7f4d7d8d6-6njxd   1/1     Running   2 (24h ago)   24h   10.131.2.86    worker3.nonprod.mypnbone.in   <none>           <none>
[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc -n openshift-file-integrity logs aide-fileintegrity-4wj57
[oneadmin@bastion ~]$ oc explain fileintegrity.spec
GROUP:      fileintegrity.openshift.io
KIND:       FileIntegrity
VERSION:    v1alpha1

FIELD: spec <Object>

DESCRIPTION:
    FileIntegritySpec defines the desired state of FileIntegrity

FIELDS:
  config        <Object> -required-
    FileIntegrityConfig defines the name, namespace, and data key for an AIDE
    config to use for integrity checking.

  debug <boolean>
    <no description>

  nodeSelector  <map[string]string>
    <no description>

  tolerations   <[]Object>
    Specifies tolerations for custom taints. Defaults to allowing scheduling on
    master and infra nodes.


[oneadmin@bastion ~]$
[oneadmin@bastion ~]$ oc explain fileintegrity.spec.config
GROUP:      fileintegrity.openshift.io
KIND:       FileIntegrity
VERSION:    v1alpha1

FIELD: config <Object>

DESCRIPTION:
    FileIntegrityConfig defines the name, namespace, and data key for an AIDE
    config to use for integrity checking.

FIELDS:
  gracePeriod   <integer>
    Time between individual aide scans

  initialDelay  <integer>
    InitialDelaySeconds is the number of seconds to wait before the first scan.
    It is an optional field, and if not specified, the operator will default to
    0

  key   <string>
    The key that contains the actual AIDE configuration in a configmap specified
    by Name and Namespace. Defaults to aide.conf

  maxBackups    <integer>
    The maximum number of AIDE database and log backups (leftover from the
    re-init process) to keep on a node.
    Older backups beyond this number are automatically pruned by the daemon.

  name  <string>
    Name of a configMap that contains custom AIDE configuration. A default
    configuration would be created if omitted.

  namespace     <string>
    Namespace of a configMap that contains custom AIDE configuration. A default
    configuration would be created if omitted.




--data-urlencode 'password=p@king1'
=================================

1. cluster log forwarding

[oneadmin@bastion ~]$ oc get clf -A
NAMESPACE           NAME       AGE
openshift-logging   instance   2y141d

=======

2. network policy 


[oneadmin@bastion ~]$ oc get networkpolicies.networking.k8s.io
NAME                              POD-SELECTOR                   AGE
allow-from-openshift-ingress      <none>                         2y155d
allow-from-openshift-monitoring   <none>                         2y155d
allow-same-namespace              <none>                         2y155d
istio-expose-route-full-install   maistra.io/expose-route=true   2y26d
istio-mesh-full-install           <none>                         2y26d

=======

3. configure an alternative identity provider


[oneadmin@bastion ~]$ oc get oauth cluster -oyaml
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - htpasswd:
      fileData:
        name: htpass-secret
    mappingMethod: claim
    name: PNB_HTpasswd
    type: HTPasswd
  - ldap:
      attributes:
        email:
        - mail
        id:
        - sAMAccountName
        name:
        - PNBONEOCP
        preferredUsername:
        - sAMAccountName
      bindDN: pnboneocp@pnb.net
      bindPassword:
        name: ldap-secret
      insecure: true
      url: ldap://pnb.net/OU=HO-DigitalBankingDivision-51750,OU=HeadOfficeUsers,DC=pnb,DC=net?sAMAccountName?sub?(&(objectclass=*)(|(memberOf=CN=OCP_MBS,OU=Custom
        Security Groups,DC=pnb,DC=net)))
    mappingMethod: claim
    name: PNB_NONPROD_LDAP
    type: LDAP
	
=======
	
4. Removing the kubeadmin user

 kubeadmin user Removed
 
=======

5. File Integrity	

[oneadmin@bastion ~]$ oc get fileintegrities.fileintegrity.openshift.io  -A
NAMESPACE                  NAME                   AGE
openshift-file-integrity   master-fileintegrity   2d22h
openshift-file-integrity   worker-fileintegrity   2d19h
[oneadmin@bastion ~]$ oc get fileintegritynodestatuses.fileintegrity.openshift.io  -A
NAMESPACE                  NAME                                               NODE                          STATUS
openshift-file-integrity   worker-fileintegrity-worker1.nonprod.mypnbone.in   worker1.nonprod.mypnbone.in   Succeeded
openshift-file-integrity   worker-fileintegrity-worker2.nonprod.mypnbone.in   worker2.nonprod.mypnbone.in   Succeeded
openshift-file-integrity   worker-fileintegrity-worker3.nonprod.mypnbone.in   worker3.nonprod.mypnbone.in   Succeeded
openshift-file-integrity   worker-fileintegrity-worker4.nonprod.mypnbone.in   worker4.nonprod.mypnbone.in   Succeeded
openshift-file-integrity   worker-fileintegrity-worker5.nonprod.mypnbone.in   worker5.nonprod.mypnbone.in   Succeeded
==================================================
# Count logs from all pods in 1 hour (approx size)
oc get pods -A -o jsonpath='{range .items[*]}{.metadata.namespace}{" "}{.metadata.name}{"\n"}{end}' \
| head -n 50 \
| while read ns pod; do
  echo "---- $ns/$pod ----"
  oc logs -n $ns $pod --since=1h | wc -c
done | awk '{sum += $1} END {print "Approx total bytes in 1h (sample): " sum/1024/1024 " MB"}'
============================================
https://console-openshift-console.apps.retaildc.mypnbone.in/k8s/ns/openshift-file-integrity/pods/aide-worker-fileintegrity-9pshw/vulnerabilities
